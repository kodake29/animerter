<div class="container">
<%# おすすめアニメ表示 %>
  <h3 class="form-title"><i class="far fa-thumbs-up"></i>おすすめ作品</h3>
    <div class="flex">
      <% @animes.each do |anime|%>
        <div class="anime-box">
          <h3><%= link_to anime.title, anime_path(anime)%></h3>
            <div class="image">
              <%= attachment_image_tag(anime, :image, :fill,150,150, fallback: "no_image.jpg", width: '100%', height: '200px',  format: "jpg")%>
            </div>
          <% @sum = 0 %>
          <% anime.episodes.each do |episode| %>
            <% episode_rate = episode.reviews.average(:rate).to_f.round(1)%>
            <% (@sum+=episode_rate) %>
          <% end %>
          <% if anime.episodes.count != 0 %>
            <div class="review-rating" data-score="<%= @sum/anime.episodes.count %>"></div>
          <% end %>
        </div>
      <% end %>
    </div>
</div>

<div class="container">
<div class="col-xs-2"></div>
<%# 最新の投稿 %>
<div class="col-xs-8">
<h3 class="form-title"><i class="far fa-comments"></i>最新の投稿</h3>

<% @reviews.each do |review|%>
<div class="comment-table">
<div class="row">
<h4 class="col-xs-4"><%= review.episode.anime.title %>
<span>第<%= review.episode.episode_number %>話</span></h4>
<div class="created"><%= link_to review.user.name,user_path(review.user) %>さんの感想</div>
</div>
<div class="row">
<div class="col-xs-4">
<%= attachment_image_tag(review.episode, :image, :fill,100,100, fallback: "no_image.jpg", size:'100x100',  format: "jpg")%>
</div>
<div class="comment col-xs-7"><%= review.comment %></div>
</div>
<div class="row">
<div class="review-rating col-xs-4" data-score="<%= review.rate %>"></div>
<div class="col-xs-4"></div>
<span><i class="fas fa-history"></i><%= time_ago_in_words(review.created_at) %> ago</span>
</div>
</div>
<% end %>

</div>
<div class="col-xs-2"></div>
</div>
<script>
  $('.review-rating').raty({
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    },
    path: '/assets/'
  });
</script>
