<div class="container">
<%# おすすめアニメ表示 %>
  <h3>おすすめ作品</h3>
    <div class="flex">
      <% @animes.each do |anime|%>
        <div class="anime-box">
          <h3><%= link_to anime.title, anime_path(anime)%></h3>
            <div class="image">
              <%= attachment_image_tag(anime, :image, :fill,200,150, fallback: "no_image.jpg", size:'200x200',  format: "jpg")%>
            </div>
          <% @sum = 0 %>
          <% anime.episodes.each do |episode| %>
            <% episode_rate = episode.reviews.average(:rate).to_f.round(1)%>
            <% (@sum+=episode_rate) %>
          <% end %>
          <% if anime.episodes.count != 0 %>
            <div class="review-rating" data-score="<%= @sum/anime.episodes.count %>"></div>
          <% end %>
        </div>
      <% end %>
    </div>
</div>

<div class="container">
<div class="col-xs-2"></div>
<%# 最新の投稿 %>
<div class="col-xs-8">
<h3>最新の投稿</h3>

<% @reviews.each do |review|%>
<div class="table">
<%= attachment_image_tag(review.episode, :image, :fill,100,100, fallback: "no_image.jpg", size:'100x100',  format: "jpg")%>
<div class="review-rating" data-score="<%= review.rate %>"></div>
<h4><%= review.episode.anime.title %>
<span>第<%= review.episode.episode_number %>話</span></h4>
<div class="comment"><%= review.comment %></div>
<div class="created"><%= link_to review.user.name, user_path(review.user)%>
<span><%= time_ago_in_words(review.created_at) %></span></div>
</div>
<% end %>

</div>
<div class="col-xs-2"></div>
</div>
<script>
  $('.review-rating').raty({
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    },
    path: '/assets/'
  });
</script>
